<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Yalla Azzouzi - Bypass Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        .btn { background: #222; padding: 10px; border: 1px solid #444; cursor: pointer; text-align: center; font-size: 11px; }
        video { width: 100%; max-width: 800px; display: block; margin: auto; background: #111; }
    </style>
</head>
<body>

    <video id="video" controls autoplay></video>
    <div id="status" style="text-align:center; padding:10px; color:red;">جاري فحص القنوات...</div>

    <div id="list" class="grid"></div>

<script>
    const playlistFiles = ['playlist.m3u8', 'playlist (2).m3u8'];
    const video = document.getElementById('video');
    const status = document.getElementById('status');

    async function start() {
        for (let file of playlistFiles) {
            try {
                const res = await fetch(file);
                const text = await res.text();
                parse(text);
            } catch (e) { console.log("File error"); }
        }
        status.innerText = "اختر قناة (تم تفعيل كسر الحماية)";
    }

    function parse(data) {
        const lines = data.split('\n');
        lines.forEach((line, i) => {
            if (line.startsWith('#EXTINF')) {
                const name = line.split(',')[1] || "Channel";
                const url = lines[i+1]?.trim();
                if (url && url.startsWith('http')) {
                    const b = document.createElement('div');
                    b.className = 'btn';
                    b.innerText = name;
                    b.onclick = () => play(url, name);
                    document.getElementById('list').appendChild(b);
                }
            }
        });
    }

    function play(url, name) {
        status.innerText = "محاولة تشغيل: " + name;
        
        // استخدام بروكسي "الهروب" القوي جداً لتجاوز حظر السيرفرات
        const bypassProxy = "https://worker-round-water-379e.azzouzi-proxy.workers.dev/?url="; 
        // إذا لم يعمل البروكسي الخاص، سنستخدم البديل العالمي:
        const globalProxy = "https://api.allorigins.win/raw?url=";
        
        const finalUrl = globalProxy + encodeURIComponent(url);

        if (Hls.isSupported()) {
            const hls = new Hls({
                xhrSetup: function(xhr, url) {
                    xhr.withCredentials = false; // لإزالة ملفات تعريف الارتباط التي قد تسبب الحظر
                }
            });
            hls.loadSource(finalUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            
            hls.on(Hls.Events.ERROR, (e, data) => {
                if (data.fatal) status.innerText = "السيرفر لا يزال يحظر الطلب.. جرب قناة أخرى";
            });
        }
    }

    start();
</script>
</body>
</html>
