<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>يلا عزوزي - بث مباشر مباريات اليوم</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --main-color: #004d40; }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background-color: var(--main-color) ! alienation; color: white; }
        #main-player { background: #000; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 30px; }
        video { width: 100%; aspect-ratio: 16/9; }
        .channel-item { cursor: pointer; border: none; transition: 0.3s; background: white; border-radius: 10px; }
        .channel-item:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .channel-logo { width: 60px; height: 60px; object-fit: contain; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container text-center">
        <a class="navbar-brand fw-bold" href="#">Yalla Azzouzi - يلا عزوزي</a>
    </div>
</nav>

<div class="container">
    <div id="main-player" class="d-none"> <video id="videoPlayer" controls autoplay></video>
        <div class="p-3 bg-dark text-white">
            <h5 id="now-playing">أنت تشاهد الآن: </h5>
        </div>
    </div>

    <h3 class="mb-3 border-bottom pb-2">القنوات الرياضية المباشرة</h3>
    <div id="channels-grid" class="row g-3 mb-5">
        <div class="text-center py-5">جاري جلب القنوات...</div>
    </div>
</div>

<script>
    const video = document.getElementById('videoPlayer');
    const playerContainer = document.getElementById('main-player');
    const nowPlayingText = document.getElementById('now-playing');
    const channelsGrid = document.getElementById('channels-grid');

    // وظيفة تشغيل القناة
    function startStream(url, name) {
        playerContainer.classList.remove('d-none');
        nowPlayingText.innerText = "أنت تشاهد الآن: " + name;
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    // جلب البيانات من الملف الذي يحدثه GitHub Action تلقائياً
    async function loadChannels() {
        try {
            const response = await fetch('channels.json');
            const data = await response.json();
            channelsGrid.innerHTML = ''; // تفريغ منطقة التحميل

            data.channels.forEach(channel => {
                const col = document.createElement('div');
                col.className = 'col-6 col-md-3 col-lg-2';
                col.innerHTML = `
                    <div class="card channel-item p-3 text-center h-100" onclick="startStream('${channel.url}', '${channel.name}')">
                        <img src="${channel.logo}" class="channel-logo mx-auto mb-2" alt="${channel.name}">
                        <div class="fw-bold small">${channel.name}</div>
                    </div>
                `;
                channelsGrid.appendChild(col);
            });
        } catch (error) {
            channelsGrid.innerHTML = '<div class="alert alert-danger">فشل تحميل القنوات، يرجى المحاولة لاحقاً.</div>';
        }
    }

    // تشغيل الجلب عند فتح الصفحة
    loadChannels();
</script>

</body>
</html>
