<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>يلا عزوزي - البث المباشر للمباريات والقنوات المشفرة</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary-bg: #0f172a; --card-bg: #1e293b; --accent-color: #38bdf8; }
        body { background-color: var(--primary-bg); color: white; font-family: 'Cairo', sans-serif; }
        .navbar { background-color: #000; border-bottom: 2px solid var(--accent-color); }
        #main-player { background: #000; border-radius: 15px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); margin-bottom: 2rem; }
        video { width: 100%; aspect-ratio: 16/9; outline: none; }
        .search-box { background: var(--card-bg); border: 1px solid #334155; color: white; border-radius: 25px; padding: 10px 20px; }
        .channel-card { 
            background: var(--card-bg); border: none; border-radius: 12px; cursor: pointer;
            transition: all 0.3s ease; height: 100%; position: relative; overflow: hidden;
        }
        .channel-card:hover { transform: translateY(-5px); border: 1px solid var(--accent-color); }
        .channel-logo { width: 100%; height: 80px; object-fit: contain; padding: 10px; background: #fff; border-radius: 8px; }
        .badge-live { position: absolute; top: 10px; right: 10px; background: red; font-size: 10px; padding: 3px 8px; border-radius: 5px; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark py-3">
    <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand fw-bold text-info" href="/">YALLA AZZOUZI LIVE</a>
        <input type="text" id="searchInput" class="search-box w-50" placeholder="ابحث عن قناة (beIN, SSC, Netflix...)...">
    </div>
</nav>

<div class="container mt-4">
    <div id="playerSection" class="d-none">
        <div id="main-player">
            <video id="videoPlayer" controls autoplay></video>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-secondary rounded">
            <h4 id="channelTitle" class="m-0 text-white">جاري التشغيل...</h4>
            <button class="btn btn-outline-light btn-sm" onclick="location.reload()">تحديث الصفحة</button>
        </div>
    </div>

    <div id="categories">
        <h3 class="mb-4 border-start border-4 border-info ps-3">قنوات رياضية ومشفرة</h3>
        <div id="channelsGrid" class="row g-3">
            <div class="text-center w-100 py-5">
                <div class="spinner-border text-info" role="status"></div>
                <p class="mt-2">جاري جلب أحدث الروابط من المستودعات...</p>
            </div>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('videoPlayer');
    const playerSection = document.getElementById('playerSection');
    const channelTitle = document.getElementById('channelTitle');
    const channelsGrid = document.getElementById('channelsGrid');
    const searchInput = document.getElementById('searchInput');
    let allChannels = [];

    // تشغيل القناة
    function playChannel(url, name) {
        playerSection.classList.remove('d-none');
        channelTitle.innerText = "بث مباشر: " + name;
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    // جلب البيانات من channels.json
    async function fetchChannels() {
        try {
            const response = await fetch('channels.json');
            const data = await response.json();
            allChannels = data.channels;
            renderChannels(allChannels);
        } catch (error) {
            channelsGrid.innerHTML = '<div class="alert alert-danger w-100 text-center">خطأ: لم يتم العثور على ملف القنوات. تأكد من تشغيل ملف البايثون أولاً.</div>';
        }
    }

    // عرض القنوات في الشبكة
    function renderChannels(channels) {
        channelsGrid.innerHTML = '';
        channels.forEach(channel => {
            const col = document.createElement('div');
            col.className = 'col-6 col-md-3 col-lg-2';
            col.innerHTML = `
                <div class="card channel-card p-2 text-center" onclick="playChannel('${channel.url}', '${channel.name}')">
                    <span class="badge-live">LIVE</span>
                    <img src="${channel.logo}" class="channel-logo mb-2" onerror="this.src='https://via.placeholder.com/150?text=TV'">
                    <div class="small fw-bold text-truncate" title="${channel.name}">${channel.name}</div>
                </div>
            `;
            channelsGrid.appendChild(col);
        });
    }

    // نظام البحث
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allChannels.filter(c => c.name.toLowerCase().includes(term));
        renderChannels(filtered);
    });

    fetchChannels();
</script>

</body>
</html>
