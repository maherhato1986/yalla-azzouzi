<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yalla Azzouzi AI | يلا عزوزي الذكي</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --accent: #00ff88; --bg: #050505; --card: #121212; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        header { background: #000; padding: 20px; text-align: center; border-bottom: 1px solid #333; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        
        /* صندوق البحث الاحترافي */
        .search-box { position: relative; max-width: 600px; margin: 0 auto 30px; }
        input { width: 100%; padding: 15px 25px; border-radius: 30px; border: 1px solid #333; background: #1a1a1a; color: white; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,255,136,0.2); }

        #player-section { background: #000; border-radius: 20px; overflow: hidden; margin-bottom: 30px; display: none; border: 1px solid var(--accent); }
        video { width: 100%; aspect-ratio: 16/9; }

        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .channel-card { background: var(--card); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; border: 1px solid #222; }
        .channel-card:hover { border-color: var(--accent); transform: scale(1.05); background: #1a1a1a; }
        .channel-card img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 10px; border-radius: 10px; }
        .channel-card h3 { font-size: 14px; margin: 0; color: #eee; }
        .channel-card p { font-size: 10px; color: var(--accent); margin-top: 5px; }

        .loading-dots { display: none; text-align: center; color: var(--accent); margin: 20px; }
    </style>
</head>
<body>

<header>
    <h1 style="color: var(--accent); margin: 0;">YALLA AZZOUZI <span style="color:white; font-size: 12px; border: 1px solid; padding: 2px 5px; border-radius: 5px;">AUTO AI</span></h1>
</header>

<div class="container">
    
    <div class="search-box">
        <input type="text" id="search" placeholder="ابحث عن أي قناة (مثلاً: MBC, beIN, Sky, CNN)..." oninput="searchChannels()">
    </div>

    <div id="player-section">
        <div style="padding: 10px; background: #000; font-size: 14px; text-align: center;" id="playing-title"></div>
        <video id="video" controls autoplay></video>
    </div>

    <div id="loader" class="loading-dots">جاري البحث في الأقمار الصناعية...</div>
    
    <div id="results" class="results-grid">
        </div>
</div>

<script>
    const video = document.getElementById('video');
    const resultsGrid = document.getElementById('results');
    const loader = document.getElementById('loader');

    // استخدام قاعدة بيانات IPTVM-Org العالمية (تضم 30 ألف قناة محدثة)
    async function searchChannels() {
        const query = document.getElementById('search').value.toLowerCase();
        if (query.length < 2) return;

        loader.style.display = 'block';

        try {
            // جلب البيانات من مستودع عالمي محدث تلقائياً
            const response = await fetch('https://iptv-org.github.io/iptv/channels.json');
            const channels = await response.json();
            
            const filtered = channels.filter(c => 
                c.name.toLowerCase().includes(query) || 
                (c.categories && c.categories.join(' ').toLowerCase().includes(query))
            ).slice(0, 20); // عرض أول 20 نتيجة فقط للسرعة

            displayResults(filtered);
        } catch (error) {
            console.error("Search error");
        } finally {
            loader.style.display = 'none';
        }
    }

    function displayResults(channels) {
        resultsGrid.innerHTML = '';
        if (channels.length === 0) {
            resultsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">لم يتم العثور على القناة.. حاول كتابة الاسم بالإنجليزية.</p>';
            return;
        }

        channels.forEach(ch => {
            const card = document.createElement('div');
            card.className = 'channel-card';
            const logo = ch.logo ? ch.logo : 'https://cdn-icons-png.flaticon.com/512/716/716429.png';
            
            card.innerHTML = `
                <img src="${logo}" onerror="this.src='https://via.placeholder.com/60/000/fff?text=TV'">
                <h3>${ch.name}</h3>
                <p>${ch.country || 'Global'}</p>
            `;
            
            card.onclick = () => getStream(ch.id, ch.name);
            resultsGrid.appendChild(card);
        });
    }

    async function getStream(channelId, name) {
        // جلب روابط البث المباشر لهذا الـ ID تحديداً
        try {
            const res = await fetch('https://iptv-org.github.io/iptv/streams.json');
            const streams = await res.json();
            const stream = streams.find(s => s.channel === channelId);

            if (stream && stream.url) {
                play(stream.url, name);
            } else {
                alert("عذراً، الرابط المباشر لهذه القناة غير متاح حالياً.");
            }
        } catch (e) { alert("خطأ في جلب البث."); }
    }

    function play(url, name) {
        document.getElementById('player-section').style.display = 'block';
        document.getElementById('playing-title').innerText = "بث مباشر: " + name;
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // نستخدم البروكسي لضمان كسر حماية المتصفح
        const finalUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);

        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(finalUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        }
    }
</script>
</body>
</html>
